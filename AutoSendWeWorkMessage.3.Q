[General]
SyntaxVersion=2
BeginHotkey=121
BeginHotkeyMod=0
PauseHotkey=122
PauseHotkeyMod=0
StopHotkey=123
StopHotkeyMod=0
RunOnce=1
EnableWindow=
MacroID=795acc8c-6546-4060-bb6a-6b1bdcb8a9cf
Description=Auto Send WeWork Message.3 自动发送企业微信消息.带界面版本
Enable=1
AutoRun=0
[Repeat]
Type=0
Number=1
[SetupUI]
Type=1
QUI=WeWorkSendForm
[Relative]
SetupOCXFile=
[Comment]

[UIPackage]
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


[Script]
Global screen_height,screen_width

//处理模式 process_model 1:创建群发送, 2:已有群名称发送,3:发送给单人
Global process_model
//EXCEL配置文件路径
Global excel_cfg_file
//EXCEL配置文件的其实读取行，结束读取行，每人发送消息数量
Global read_line_num, start_read_line, send_msg_num
//企业微信的发送快捷键 1, Enter发送，2 Ctrl+Enter发送
Global wework_send_shortcuts

Global group_users, group_name, user_name

Global send_msg_1,send_msg_2,send_msg_3

Event WeWorkSendForm.button_openexcel.Click
	excel_cfg_file = Plugin.File.SelectFile()
	WeWorkSendForm.input_excel.Text = excel_cfg_file
End Event

Event WeWorkSendForm.button_send.Click
	Dim cfg_error
	excel_cfg_file = WeWorkSendForm.input_excel.Text
    process_model = WeWorkSendForm.combo_model.ListIndex + 1
	send_msg_num = WeWorkSendForm.combo_msgnum.ListIndex + 1
	wework_send_shortcuts = WeWorkSendForm.combo_shortcut.ListIndex + 1
	end_read_line = CInt(WeWorkSendForm.input_endline.Text)
	start_read_line = CInt(WeWorkSendForm.input_startline.Text)
    CheckConfig (cfg_error)
	If cfg_error = True Then 
		Goto END_SEND
	Else
		Call ProcessAutoSendByModel()
	End If
	Rem END_SEND
	TracePrint "Config error Got Event End"
End Event

Event WeWorkSendForm.button_stopscript.Click
	ExitScript
End Event

Event WeWorkSendForm.button_help.Click
	RunApp "https://docs.qq.com/doc/DRFhHUE1qc25RcnJl"
End Event

//窗口加载
Event WeWorkSendForm.Load

	screen_width = Plugin.sys.GetScRX()
	screen_height = Plugin.sys.GetScRY() 
	TracePrint "screen width:" & screen_width & ",height:" & screen_height
	
	//如果没有读取配置，用默认配置
	Dim cfg_str
	cfg_str = Plugin.File.ReadINI("EXCEL", "FILE", ".\AutoWeWorkSend.ini")
	If Len(cfg_str) = 0 Then
		excel_cfg_file = "D:\Test002.xlsx"
	Else 
		excel_cfg_file = cfg_str
	End If
	TracePrint "Process excel file :"&excel_cfg_file
	cfg_str = Plugin.File.ReadINI("EXCEL", "MSG_NUM", ".\AutoWeWorkSend.ini")
	If Len(cfg_str) = 0 Then
		send_msg_num = 3
	Else 
		send_msg_num = CInt(cfg_str)
	End If
	TracePrint "Send message number  :"&send_msg_num&" cfg_str:"&cfg_str
	cfg_str = Plugin.File.ReadINI("EXCEL", "START_LINE", ".\AutoWeWorkSend.ini")
	If Len(cfg_str) = 0 Then
		start_read_line = 2
	Else 
		start_read_line = CInt(cfg_str)
	End If
	cfg_str = Plugin.File.ReadINI("EXCEL", "END_LINE", ".\AutoWeWorkSend.ini")
	If Len(cfg_str) = 0 Or end_read_line <= 0 Or end_read_line < start_read_line Then
		end_read_line = 2
	Else 
		end_read_line = CInt(cfg_str)
	End If
	TracePrint "Send message number  :"&send_msg_num&" start read line:"&start_read_line&" end read line:"&end_read_line
	cfg_str = Plugin.File.ReadINI("PROCESS", "MODEL", ".\AutoWeWorkSend.ini")
	If Len(cfg_str) = 0 Or  process_model < 1 Or process_model > 2 Then
		process_model = 2
	Else 
		process_model = CInt(cfg_str)
	End If
	TracePrint "Send message number  :"&process_model &" cfg_str"&cfg_str
	cfg_str = Plugin.File.ReadINI("SHORTCUTS", "WEWORK_SEND", ".\AutoWeWorkSend.ini")
	If Len(cfg_str) = 0 Then
		wework_send_shortcuts = 2
	Else 
		wework_send_shortcuts = CInt(cfg_str)
	End If
	TracePrint "Process model  :" & process_model & " wework send shortcuts:" & wework_send_shortcuts
	read_line_num = end_read_line - start_read_line + 1
	
	CheckConfig(cfg_error)

	WeWorkSendForm.input_excel.Text = excel_cfg_file
    WeWorkSendForm.combo_model.ListIndex = process_model - 1
	WeWorkSendForm.combo_msgnum.ListIndex = send_msg_num - 1
	WeWorkSendForm.input_startline.Text = start_read_line
	WeWorkSendForm.input_endline.Text = end_read_line
	WeWorkSendForm.combo_shortcut.ListIndex = wework_send_shortcuts - 1
	WeWorkSendForm.progress_send.Value = 0

End Event

//窗口关闭调用函数
Event WeWorkSendForm.UnLoad
    Call Plugin.File.WriteINI("EXCEL", "FILE", excel_cfg_file, ".\AutoWeWorkSend.ini")
    Call Plugin.File.WriteINI("EXCEL", "MSG_NUM", send_msg_num, ".\AutoWeWorkSend.ini")
    Call Plugin.File.WriteINI("EXCEL", "START_LINE", start_read_line, ".\AutoWeWorkSend.ini")
    Call Plugin.File.WriteINI("EXCEL", "END_LINE", end_read_line, ".\AutoWeWorkSend.ini")
    Call Plugin.File.WriteINI("PROCESS", "MODEL", process_model, ".\AutoWeWorkSend.ini")
    Call Plugin.File.WriteINI("SHORTCUTS", "WEWORK_SEND", wework_send_shortcuts, ".\AutoWeWorkSend.ini")
End Event

Function ProcessAutoSendByModel()
	//把企业微信的窗口呼叫到前面
	Call ForegroundWeWorkWnd()
	
	If process_model = 1 Then 
	Call CreateGroupAndSendMsg()
	ElseIf	 process_model = 2 Then
		Call FindGroupAndSendMsg()
	ElseIf	 process_model = 3 Then
		Call FindUserAndSendMsg()
	Else 
		TracePrint "process_model error must equal 1,2,3 :" & process_model
		ExitScript
	End If
	MessageBox "消息发送执行结束，已经停止！"
End Function

Function ForegroundWeWorkWnd()
	Dim hwnd_qw_main,hwnd_fg
	hwnd_qw_main = Plugin.Window.Find("WeWorkWindow", 0)
	//Call Plugin.Window.Top(hwnd_qw_main, 0)
	//Delay 1000
	Call Plugin.Window.Active(hwnd_qw_main)
	Delay 2500
	hwnd_fg = Plugin.Window.Foreground()
	If hwnd_fg = hwnd_qw_main Then
		TracePrint ("Active QY Weixin OK.")
	Else
		TracePrint ("Active QY Weixin  No OK.")
		MessageBox "无法激活企业微信窗口"
		ExitScript
	End If
		
	Dim rect, rect_array
	rect = Plugin.Window.GetClientRect(hwnd_qw_main)
	rect_array = Split(rect, "|")
	wleft = Clng(rect_array(0)): wtop = Clng(rect_array(1))   
	wright = Clng(rect_array(2)) : wbottom = Clng(rect_array(3))
	TracePrint "Rect  " & wleft & "," & wtop & "," & wright & "," & wbottom
End Function

//检查配置是否OK
Function CheckConfig(cfg_error)
	cfg_error = False
	//对配置进行各种检查
	TracePrint "send_msg_num(must <3):" & send_msg_num
	If send_msg_num > 3 Or send_msg_num <= 0 Then 
		MessageBox "一次给一个群发送的消息数量不熟练数量不能过大，1<number<3"
		cfg_error = True
		send_msg_num = 3
	End If
	TracePrint "read_line_num(must >0):" & read_line_num &" end_read_line" & end_read_line
	If read_line_num <= 0 Or start_read_line <= 0 Or end_read_line <= 0 Then 
		MessageBox "一次给一个群发送的消息数量不熟练数量不能过大，1<number<3"
		cfg_error = True
		start_read_line = 2
		end_read_line = 2
	End If
	TracePrint "process_model( eaqul 1,2,3):" & process_model
	If process_model < 1 Or process_model > 3 Then 
		MessageBox "处理模式必须是( eaqul 1,2,3):" & process_model
		cfg_error = True
		process_model = 2
	End If
	TracePrint "wework_send_shortcuts( eaqul 1,2):" & wework_send_shortcuts
	If wework_send_shortcuts < 1 Or wework_send_shortcuts > 2 Then 
		MessageBox "发送快捷键配置必须是1 OR 2:" & wework_send_shortcuts
		cfg_error = True
		wework_send_shortcuts = 2
	End If
	read_line_num = end_read_line - start_read_line + 1
End Function

//创建群，然后发送消息
Function CreateGroupAndSendMsg()
	Dim read_num
	read_num = 0
	Call Plugin.Office.OpenXls(excel_cfg_file)
	While read_num < read_line_num
    	
		Call ReadConfigFromExcel(start_read_line + read_num)
    	Call OpenCreateGroupChatWnd()
    	Call CreateGroupChat(group_users)
    	Call RenameGroupChatMainWnd(group_name)
    	Call EnterFindWnd()
    	Call FindGroupChatWnd(group_name)
		Call BatchSendWeWorkMessage()
    	read_num = read_num + 1
    	WeWorkSendForm.progress_send.Value = 100 * read_num / read_line_num
	Wend
	Call Plugin.Office.CloseXls()
End Function

//根据群名称找到群，然后发送消息
Function FindGroupAndSendMsg()
	Dim read_num
	read_num = 0
	Call Plugin.Office.OpenXls(excel_cfg_file)
	While read_num < read_line_num
    	
		Call ReadConfigFromExcel(start_read_line + read_num)
    	Call EnterFindWnd()
    	Call FindGroupChatWnd(group_name)
		Call BatchSendWeWorkMessage()
    	read_num = read_num + 1
    	WeWorkSendForm.progress_send.Value = 100 * read_num / read_line_num
	Wend
	Call Plugin.Office.CloseXls()
End Function

Function FindUserAndSendMsg()
	Dim read_num
	read_num = 0
	Call Plugin.Office.OpenXls(excel_cfg_file)
	While read_num < read_line_num
    	
		Call ReadConfigFromExcel(start_read_line + read_num)
    	Call EnterFindWnd()
    	Call FindGroupChatWnd(user_name)
		Call BatchSendWeWorkMessage()
    	read_num = read_num + 1
    	WeWorkSendForm.progress_send.Value = 100 * read_num / read_line_num
	Wend
	Call Plugin.Office.CloseXls()
End Function

Function ReadConfigFromExcel(line_num)
	Dim msg_read_col
	If process_model = 1 Or process_model = 2 Then
    	group_users = Plugin.Office.ReadXls(1, line_num, 1)
    	group_name = Plugin.Office.ReadXls(1, line_num, 2)
    	
    	If group_users = "" Or group_name = "" Then 
    		TracePrint ("EXCEL have not config.")
			MessageBox "EXCEL 中没有相应的数据"
			ExitScript
		End If
		msg_read_col = 3
    Else 
		user_name = Plugin.Office.ReadXls(1, line_num, 1)
		msg_read_col = 2
    End If	
    
	If send_msg_num = 1 Then 
		send_msg_1 = Plugin.Office.ReadXls(1, line_num, msg_read_col + 0)
	ElseIf send_msg_num = 2 Then 
		send_msg_1 = Plugin.Office.ReadXls(1, line_num + read_num, msg_read_col + 0)
		send_msg_2 = Plugin.Office.ReadXls(1, line_num + read_num, msg_read_col + 1)
	// = 3
	Else 
		send_msg_1 = Plugin.Office.ReadXls(1, line_num, msg_read_col + 0)
		send_msg_2 = Plugin.Office.ReadXls(1, line_num, msg_read_col + 1)
		send_msg_3 = Plugin.Office.ReadXls(1, line_num, msg_read_col + 2)
	End If
End Function

//Ctrl + N 打开创建群聊的窗口
Function OpenCreateGroupChatWnd()
	KeyDown 17, 1
    Delay 100
    KeyPress 78, 1
    Delay 100
    KeyUp 17, 1
    Delay 2000
End Function

//批量发送消息
Function BatchSendWeWorkMessage()
	If send_msg_num = 1 Then 
		Call SendWeWorkMessage(send_msg_1)
	ElseIf send_msg_num = 2 Then 
		Call SendWeWorkMessage(send_msg_1)
		Call SendWeWorkMessage(send_msg_2)
	// = 3
    Else 
		Call SendWeWorkMessage(send_msg_1)
		Call SendWeWorkMessage(send_msg_2)
		Call SendWeWorkMessage(send_msg_3)
	End If
End Function

//Ctrl + Enter Or Enter 发送消息
Function SendWeWorkMessage(one_msg)
    SayString one_msg
    Delay 1500
    //这个地方选择的Ctrl + Enter 发送，其他地方可能
    If wework_send_shortcuts = 1 Then 
    	KeyPress "Enter", 1
    	Delay 1500
    ElseIf wework_send_shortcuts = 2 Then 
		KeyDown 17, 1
    	Delay 30
    	KeyPress "Enter", 1
    	Delay 30
    	KeyUp 17, 1
    	Delay 1500
    End If
End Function

//创建群聊
Function CreateGroupChat(group_users)
	Plugin.Sys.SetCLB(group_users)
 	KeyDown 17, 1
 	 Delay 100
	KeyPress 86, 1
	 Delay 100
	KeyUp 17, 1
	Delay 3500
    KeyPress "Enter", 2
    Delay 1500
End Function

//对群联窗口改名
Function RenameGroupChatMainWnd(group_name)
	TracePrint "RenameGroupChatMainWnd"
	//根据窗口"+"定位
	Dim xy_array,xy,x,y
	xy = Plugin.Color.FindMultiColorEx(wleft,wtop,wright,wtop+90,"000000","0|0|000000,1|0|000000,0|1|000000,1|1|000000,0|2|000000,1|2|000000,0|3|000000,1|3|000000",1,0)
	xy_array = Split(xy, "|")
	x = CInt(xy_array(0)) : y = CInt(xy_array(1))
	TracePrint "Fild xy "&xy&" "& x &"," &y
	//如果没有找到，退出
	If x < 0 Or y < 0 Then 
		TracePrint "Not Fild Group Chat Name Windows "
		ExitScript
	End If
	//进入群名称窗口，
    MoveTo x, y
    Delay 200
    LeftClick 1
    SayString group_name
	Delay 200
	MoveR 150, 0
    LeftClick 1
    Delay 200
End Function

//对群联窗口改名
Function RenameGroupChatWnd(group_name)
    hwnd_qw_c = Plugin.Window.Find("WwStandaloneConversationWnd", 0)
    Call Plugin.Bkgnd.LeftClick(hwnd_qw_c, 30, 40)
	Delay 500
    SayString group_name
   Delay 1500
End Function

//Ctrl+O 
Function OpenGroupChatWnd()
	TracePrint "Ctrl+O OpenGroupChatWnd"
	KeyDown 17, 1
    Delay 30
    KeyPress 79, 1
    Delay 30
    KeyUp 17, 1
    Delay 1000
End Function

//Esc
Function CloseGroupChatWnd()
	KeyPress "Esc", 1
    TracePrint "Esc CloseGroupChatWnd"
    Delay 1000
End Function

Function  EnterFindWnd()
    KeyPress 18,1
    Delay 30
    KeyPress 18,1
    Delay 30
    TracePrint "Alt + Alt EnterFindWnd"
    Delay 500
End Function

Function FindGroupChatWnd(find_name)
	TracePrint "FindGroupChatWnd "
	//全选所有的内容，（删除原来的内容）
    KeyDown 17, 1
    Delay 30
	KeyPress 65, 1
	Delay 30
	KeyUp 17, 1
	Delay 500
	SayString find_name
	Delay 1500
    //如果认为那个放大镜非常靠近，则是没有找到
    Dim xy_array,xy,x,y
	xy =Plugin.Color.FindMultiColorEx(wleft,wtop,wleft+300,wtop+160,"56B059","0|0|56B059,1|0|56B059,2|0|56B059,0|1|56B059,1|1|56B059,2|1|56B059,0|2|56B059,1|2|56B059,2|2|56B059,3|2|56B059,3|2|56B059,3|2|56B059",0.9,0)
	xy_array = Split(xy, "|")
	x = CInt(xy_array(0)) : y = CInt(xy_array(1))
	TracePrint "Fild xy " & xy &","& x &"," &y
	//如果找到绿色放大镜子，表示搜索内容其实没有找到（这有点扰），退出
	If x > 0 Or y > 0 Then 
		TracePrint "FindGroupChatWnd Not find group :["&find_name&"] to send message"
		ExitScript
	End If
	KeyPress "Enter", 1
	Delay 500	
End Function

// 脚本结束时提示，同事也处理一些异常终止情况。
Sub OnScriptExit()
    KeyUp 17, 1
    Call Plugin.Office.CloseXls()
End Sub



